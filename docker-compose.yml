version: '3.8'

services:
  bob-app:
    build: .
    container_name: everpetz-bob
    restart: always
    # Mantemos root para garantir permissão total de escrita no volume interno
    user: root
    ports:
      - "8050:8050"
    volumes:
      # --- A BLINDAGEM (Persistência Segura) ---
      # Mapeia o caminho interno do banco para um Volume Docker Nativo.
      # Isso salva os dados mesmo se o container reiniciar, SEM travar no Windows.
      - chroma_safe_storage:/app/banco_vetorial_seguro
      # -----------------------------------------
      
      - ./knowledge_base:/app/knowledge_base
      - ./assets:/app/assets
      - ./google-shopping.xml:/app/google-shopping.xml
      
      # Persistência do Banco de Usuários (Login) - Opcional
      # - ./bob_database.sqlite:/app/bob_database.sqlite

    environment:
      - TZ=America/Sao_Paulo
      - OPENAI_API_KEY=${OPENAI_API_KEY}

# Declaração do Volume (O Cofre Linux)
volumes:
  chroma_safe_storage: